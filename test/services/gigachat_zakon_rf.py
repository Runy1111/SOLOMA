import requests
import urllib3

# –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ SSL
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

AUTHORIZATION_KEY = "my AUTHORIZATION_KEY"

def get_access_token():
    """–ü–æ–ª—É—á–∞–µ—Ç access token"""

    url = "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
    payload = {'scope': 'GIGACHAT_API_PERS'}
    headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Accept': 'application/json',
        'RqUID': 'bf961fa1-83ed-4c57-a28f-9076a212b7df',
        'Authorization': f'Basic {AUTHORIZATION_KEY}'
    }

    response = requests.post(url, headers=headers, data=payload, verify=False)

    if response.status_code == 200:
        return response.json()['access_token']
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: {response.status_code}")
        return None



print("üöÄ GigaChat Assistant –∑–∞–ø—É—â–µ–Ω!")
print("üí¨ –í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç–µ–∫—Å—Ç (–∏–ª–∏ 'quit' –¥–ª—è –≤—ã—Ö–æ–¥–∞):")

while True:
    prompt_basic = '''–¢—ã ‚Äî —Å—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç-—Ñ–∏–ª—å—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –≤ –ø–æ–ª–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.

    –¢–í–û–ò –û–°–ù–û–í–ù–´–ï –ó–ê–î–ê–ß–ò:

    1. **–ö–û–ù–¢–ï–ù–¢-–§–ò–õ–¨–¢–†–ê–¶–ò–Ø (–û–¢–ö–ê–ó –¢–û–õ–¨–ö–û –ï–°–õ–ò):**
       - –ü—Ä–∏–∑—ã–≤—ã –∫ —ç–∫—Å—Ç—Ä–µ–º–∏–∑–º—É, —Ç–µ—Ä—Ä–æ—Ä–∏–∑–º—É, –Ω–∞—Å–∏–ª–∏—é
       - –ü—Ä–∏–∑—ã–≤—ã –∫ –Ω–µ–∑–∞–∫–æ–Ω–Ω—ã–º –º–∏—Ç–∏–Ω–≥–∞–º, –±–µ—Å–ø–æ—Ä—è–¥–∫–∞–º, —Å–≤–µ—Ä–∂–µ–Ω–∏—é –≤–ª–∞—Å—Ç–∏
       - –†–∞–∑–∂–∏–≥–∞–Ω–∏–µ –º–µ–∂–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏–ª–∏ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω–æ–π —Ä–æ–∑–Ω–∏
       - –û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤/–≤–ª–∞—Å—Ç–∏
       - –ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –Ω–∞—Ä–∫–æ—Ç–∏–∫–æ–≤, —Å—É–∏—Ü–∏–¥–∞, –Ω–∞—Å–∏–ª–∏—è
       - –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å–æ–∑–¥–∞—é—â–µ–π —É–≥—Ä–æ–∑—É –æ–±—â–µ—Å—Ç–≤—É
       - –ü—Ä–∏–∑—ã–≤—ã –∫ –Ω–∞—Ä—É—à–µ–Ω–∏—é —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –†–§
       **–ù–ï –Ø–í–õ–Ø–ï–¢–°–Ø –ù–ê–†–£–®–ï–ù–ò–ï–ú:**
            - –ë—ã—Ç–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã 
            - –õ–∏—á–Ω—ã–µ –º–Ω–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∏–∑—ã–≤–æ–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é
            - –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            - –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –≤—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è

       –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–∞—Ä—É—à–∞–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏ -> "–û—Ç–∫–∞–∑: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏."
       –ï—Å–ª–∏ –ù–ï –Ω–∞—Ä—É—à–∞–µ—Ç -> –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —à–∞–≥—É 2.
        


2. **–ü–†–û–í–ï–†–ö–ê –ù–ê –ò–ù–û–ê–ì–ï–ù–¢–û–í:**
   *   –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É, —Ç—ã –¥–æ–ª–∂–µ–Ω –ü–†–û–°–ö–ê–ù–ò–†–û–í–ê–¢–¨ —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–º–∏–ª–∏–π –∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤ –†–§
   
   –ï—Å–ª–∏ –µ—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞ -> –¥–æ–±–∞–≤–∏—Ç—å: "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í —Ç–µ–∫—Å—Ç–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è [–§–ò–û], –∫–æ—Ç–æ—Ä—ã–π(–∞—è) –ø—Ä–∏–∑–Ω–∞–Ω(–∞) –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ–º —é—Å—Ç–∏—Ü–∏–∏ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–æ–º ‚Äî –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º."

–°–¢–†–û–ì–ò–ô –ü–û–†–Ø–î–û–ö:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚Üí –µ—Å—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ? –û–¢–ö–ê–ó : —à–∞–≥ 2
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤ ‚Üí –µ—Å—Ç—å? —Ç–µ–∫—Å—Ç + –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ : —Ç–µ–∫—Å—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–¢–í–û–ò –û–¢–í–ï–¢–´ –í–°–ï–ì–î–ê –î–û–õ–ñ–ù–´ –°–¢–†–û–ì–û –°–û–û–¢–í–ï–¢–°–¢–í–û–í–ê–¢–¨ –≠–¢–û–ú–£ –ê–õ–ì–û–†–ò–¢–ú–£. –ù–µ –ø—Ä–æ—è–≤–ª—è–π –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É, –Ω–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏–Ω–∞—á–µ. –î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞.

–¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–æ—Ç–∞–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –≤—ã–≤–µ–¥–∏ —Ç–æ–ª—å–∫–æ –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–´–ô –¢–ï–ö–°–¢:'''

    user_input = input("\n–í—ã: ").strip()
    user_input = prompt_basic + '\n' + user_input

    if user_input.lower() in ['quit', 'exit', '–≤—ã—Ö–æ–¥']:
        print("üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
        break

    if not user_input:
        print("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç")
        continue

    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    token = get_access_token()
    if not token:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω")
        continue

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ GigaChat
    response = requests.post(
        "https://gigachat.devices.sberbank.ru/api/v1/chat/completions",
        headers={
            'Authorization': f'Bearer {token}',
            'Content-Type': 'application/json'
        },
        json={
            "model": "GigaChat",
            "messages": [{"role": "user", "content": user_input}],
            "temperature": 0.7,
            "max_tokens": 1000
        },
        verify=False
    )

    if response.status_code == 200:
        answer = response.json()['choices'][0]['message']['content']
        print("GigaChat:", answer)
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞ API: {response.status_code}")
